{"version":3,"file":"abp-ng.setting-management.umd.js","sources":["ng://@abp/ng.setting-management/lib/services/setting-management.service.ts","ng://@abp/ng.setting-management/lib/components/setting-layout.component.ts","ng://@abp/ng.setting-management/lib/constants/routes.ts","ng://@abp/ng.setting-management/lib/setting-management-routing.module.ts","ng://@abp/ng.setting-management/lib/setting-management.module.ts"],"sourcesContent":["import { SettingTab } from '@abp/ng.theme.shared';\nimport { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Navigate } from '@ngxs/router-plugin';\nimport { Store, Actions, ofActionSuccessful } from '@ngxs/store';\nimport { Subject } from 'rxjs';\nimport { ConfigState, GetAppConfiguration } from '@abp/ng.core';\nimport { OAuthService } from 'angular-oauth2-oidc';\nimport { takeUntil } from 'rxjs/operators';\n\n@Injectable({ providedIn: 'root' })\nexport class SettingManagementService {\n  settings: SettingTab[] = [];\n\n  selected = {} as SettingTab;\n\n  private destroy$ = new Subject();\n\n  constructor(\n    private actions: Actions,\n    private router: Router,\n    private store: Store,\n    private oAuthService: OAuthService,\n  ) {\n    setTimeout(() => this.setSettings(), 0);\n\n    this.actions\n      .pipe(ofActionSuccessful(GetAppConfiguration))\n      .pipe(takeUntil(this.destroy$))\n      .subscribe(() => {\n        if (this.oAuthService.hasValidAccessToken()) {\n          this.setSettings();\n        }\n      });\n  }\n\n  ngOnDestroy() {\n    this.destroy$.next();\n  }\n\n  setSettings() {\n    const route = this.router.config.find(r => r.path === 'setting-management');\n    this.settings = (route.data.settings as SettingTab[])\n      .filter(setting => this.store.selectSnapshot(ConfigState.getGrantedPolicy(setting.requiredPolicy)))\n      .sort((a, b) => a.order - b.order);\n    this.checkSelected();\n  }\n\n  checkSelected() {\n    this.selected = this.settings.find(setting => setting.url === this.router.url) || ({} as SettingTab);\n\n    if (!this.selected.name && this.settings.length) {\n      this.setSelected(this.settings[0]);\n    }\n  }\n\n  setSelected(selected: SettingTab) {\n    this.selected = selected;\n    this.store.dispatch(new Navigate([selected.url]));\n  }\n}\n","import { eLayoutType } from '@abp/ng.core';\nimport { SettingTab } from '@abp/ng.theme.shared';\nimport { Component, TrackByFunction } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { timer } from 'rxjs';\nimport { SettingManagementService } from '../services/setting-management.service';\n\n@Component({\n  selector: 'abp-setting-layout',\n  templateUrl: './setting-layout.component.html',\n})\nexport class SettingLayoutComponent {\n  // required for dynamic component\n  static type = eLayoutType.setting;\n\n  trackByFn: TrackByFunction<SettingTab> = (_, item) => item.name;\n\n  constructor(public settingManagementService: SettingManagementService, private router: Router) {\n    if (\n      settingManagementService.selected &&\n      this.router.url !== settingManagementService.selected.url &&\n      settingManagementService.settings.length\n    ) {\n      settingManagementService.setSelected(settingManagementService.settings[0]);\n    }\n  }\n\n  ngOnDestroy() {}\n}\n","import { ABP, eLayoutType } from '@abp/ng.core';\n\nexport const SETTING_MANAGEMENT_ROUTES = {\n  routes: [\n    {\n      name: 'Settings',\n      path: 'setting-management',\n      parentName: 'AbpUiNavigation::Menu:Administration',\n      layout: eLayoutType.application,\n      order: 6,\n      iconClass: 'fa fa-cog',\n    },\n  ] as ABP.FullRoute[],\n};\n","import { DynamicLayoutComponent } from '@abp/ng.core';\nimport { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { SETTING_MANAGEMENT_ROUTES } from './constants/routes';\nimport { SettingLayoutComponent } from './components/setting-layout.component';\n\nconst routes: Routes = [\n  {\n    path: 'setting-management',\n    component: DynamicLayoutComponent,\n    children: [{ path: '', component: SettingLayoutComponent }],\n    data: { routes: SETTING_MANAGEMENT_ROUTES, settings: [] },\n  },\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class SettingManagementRoutingModule {}\n","import { CoreModule } from '@abp/ng.core';\nimport { ThemeSharedModule } from '@abp/ng.theme.shared';\nimport { NgModule } from '@angular/core';\nimport { SettingLayoutComponent } from './components/setting-layout.component';\nimport { SettingManagementRoutingModule } from './setting-management-routing.module';\n\nexport const SETTING_LAYOUT = SettingLayoutComponent;\n\n@NgModule({\n  declarations: [SETTING_LAYOUT],\n  imports: [SettingManagementRoutingModule, CoreModule, ThemeSharedModule],\n  entryComponents: [SETTING_LAYOUT],\n})\nexport class SettingManagementModule {}\n"],"names":["store","Subject","ofActionSuccessful","GetAppConfiguration","takeUntil","ConfigState","Navigate","Injectable","Actions","Router","Store","OAuthService","Component","DynamicLayoutComponent","NgModule","RouterModule","CoreModule","ThemeSharedModule"],"mappings":";;;;;;;;;;AACA;QAiBE,kCACU,OAAgB,EAChB,MAAc,EACdA,OAAY,EACZ,YAA0B;YAJpC,iBAgBC;YAfS,YAAO,GAAP,OAAO,CAAS;YAChB,WAAM,GAAN,MAAM,CAAQ;YACd,UAAK,GAALA,OAAK,CAAO;YACZ,iBAAY,GAAZ,YAAY,CAAc;YAVpC,aAAQ,GAAiB,EAAE,CAAC;YAE5B,aAAQ,sBAAG,EAAE,EAAc,CAAC;YAEpB,aAAQ,GAAG,IAAIC,YAAO,EAAE,CAAC;YAQ/B,UAAU;;;YAAC,cAAM,OAAA,KAAI,CAAC,WAAW,EAAE,GAAA,GAAE,CAAC,CAAC,CAAC;YAExC,IAAI,CAAC,OAAO;iBACT,IAAI,CAACC,wBAAkB,CAACC,2BAAmB,CAAC,CAAC;iBAC7C,IAAI,CAACC,mBAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iBAC9B,SAAS;;;YAAC;gBACT,IAAI,KAAI,CAAC,YAAY,CAAC,mBAAmB,EAAE,EAAE;oBAC3C,KAAI,CAAC,WAAW,EAAE,CAAC;iBACpB;aACF,EAAC,CAAC;SACN;;;;QAED,8CAAW;;;QAAX;YACE,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;SACtB;;;;QAED,8CAAW;;;QAAX;YAAA,iBAMC;;gBALO,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI;;;;YAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,IAAI,KAAK,oBAAoB,GAAA,EAAC;YAC3E,IAAI,CAAC,QAAQ,GAAG,oBAAC,KAAK,CAAC,IAAI,CAAC,QAAQ;iBACjC,MAAM;;;;YAAC,UAAA,OAAO,IAAI,OAAA,KAAI,CAAC,KAAK,CAAC,cAAc,CAACC,mBAAW,CAAC,gBAAgB,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC,GAAA,EAAC;iBAClG,IAAI;;;;;YAAC,UAAC,CAAC,EAAE,CAAC,IAAK,OAAA,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,GAAA,EAAC,CAAC;YACrC,IAAI,CAAC,aAAa,EAAE,CAAC;SACtB;;;;QAED,gDAAa;;;QAAb;YAAA,iBAMC;YALC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI;;;;YAAC,UAAA,OAAO,IAAI,OAAA,OAAO,CAAC,GAAG,KAAK,KAAI,CAAC,MAAM,CAAC,GAAG,GAAA,EAAC,wBAAK,EAAE,GAAe,CAAC;YAErG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;gBAC/C,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;aACpC;SACF;;;;;QAED,8CAAW;;;;QAAX,UAAY,QAAoB;YAC9B,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;YACzB,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAIC,qBAAQ,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;SACnD;;oBAjDFC,eAAU,SAAC,EAAE,UAAU,EAAE,MAAM,EAAE;;;;oBANlBC,aAAO;oBAFdC,aAAM;oBAENC,WAAK;oBAGLC,8BAAY;;;uCAPrB;KAUA,IAkDC;;;QAhDC,4CAA4B;;QAE5B,4CAA4B;;;;;QAE5B,4CAAiC;;;;;QAG/B,2CAAwB;;;;;QACxB,0CAAsB;;;;;QACtB,yCAAoB;;;;;QACpB,gDAAkC;;;;;;;ACpBtC;QAeE,gCAAmB,wBAAkD,EAAU,MAAc;YAA1E,6BAAwB,GAAxB,wBAAwB,CAA0B;YAAU,WAAM,GAAN,MAAM,CAAQ;YAF7F,cAAS;;;;;YAAgC,UAAC,CAAC,EAAE,IAAI,IAAK,OAAA,IAAI,CAAC,IAAI,GAAA,EAAC;YAG9D,IACE,wBAAwB,CAAC,QAAQ;gBACjC,IAAI,CAAC,MAAM,CAAC,GAAG,KAAK,wBAAwB,CAAC,QAAQ,CAAC,GAAG;gBACzD,wBAAwB,CAAC,QAAQ,CAAC,MAAM,EACxC;gBACA,wBAAwB,CAAC,WAAW,CAAC,wBAAwB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;aAC5E;SACF;;;;QAED,4CAAW;;;QAAX,eAAgB;;QAdT,2BAAI,2BAAuB;;oBANnCC,cAAS,SAAC;wBACT,QAAQ,EAAE,oBAAoB;wBAC9B,i+DAA8C;qBAC/C;;;;oBALQ,wBAAwB;oBAFxBH,aAAM;;QAyBf,6BAAC;KArBD,IAqBC;;;QAfC,4BAAkC;;QAElC,2CAAgE;;QAEpD,0DAAyD;;;;;QAAE,wCAAsB;;;;;;;;ACf/F,QAAa,yBAAyB,GAAG;QACvC,MAAM,qBAAE;YACN;gBACE,IAAI,EAAE,UAAU;gBAChB,IAAI,EAAE,oBAAoB;gBAC1B,UAAU,EAAE,sCAAsC;gBAClD,MAAM;gBACN,KAAK,EAAE,CAAC;gBACR,SAAS,EAAE,WAAW;aACvB;SACF,EAAmB;KACrB;;;;;;ICbD,SAWU,EAAE,MAAM,EAAE,yBAAyB,EAAE,QAAQ,EAAE,EAAE,EAAE;;QALvD,MAAM,GAAW;QACrB;YACE,IAAI,EAAE,oBAAoB;YAC1B,SAAS,EAAEI,8BAAsB;YACjC,QAAQ,EAAE,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,SAAS,EAAE,sBAAsB,EAAE,CAAC;YAC3D,IAAI,IAAqD;SAC1D;KACF;AAED;QAAA;SAI8C;;oBAJ7CC,aAAQ,SAAC;wBACR,OAAO,EAAE,CAACC,mBAAY,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;wBACxC,OAAO,EAAE,CAACA,mBAAY,CAAC;qBACxB;;QAC4C,qCAAC;KAJ9C;;;;;;ICfA;AAMA,QAAa,cAAc,GAAG,sBAAsB;AAEpD;QAAA;SAKuC;;oBALtCD,aAAQ,SAAC;wBACR,YAAY,EAAE,CAAC,cAAc,CAAC;wBAC9B,OAAO,EAAE,CAAC,8BAA8B,EAAEE,kBAAU,EAAEC,iCAAiB,CAAC;wBACxE,eAAe,EAAE,CAAC,cAAc,CAAC;qBAClC;;QACqC,8BAAC;KALvC;;;;;;;;;;;;;;;;;;"}