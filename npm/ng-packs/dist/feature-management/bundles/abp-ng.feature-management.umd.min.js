!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@abp/ng.core"),require("@abp/ng.theme.shared"),require("@angular/core"),require("@ngxs/store"),require("rxjs"),require("rxjs/operators"),require("@angular/forms")):"function"==typeof define&&define.amd?define("@abp/ng.feature-management",["exports","@abp/ng.core","@abp/ng.theme.shared","@angular/core","@ngxs/store","rxjs","rxjs/operators","@angular/forms"],t):t(((e=e||self).abp=e.abp||{},e.abp.ng=e.abp.ng||{},e.abp.ng["feature-management"]={}),e.ng_core,e.ng_theme_shared,e.ng.core,e.store,e.rxjs,e.rxjs.operators,e.ng.forms)}(this,(function(e,t,r,n,a,o,i,u){"use strict";
/*! *****************************************************************************
    ***************************************************************************** */function s(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(a=e[u])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i}function p(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var c=function(){function e(e){this.payload=e}return e.type="[FeatureManagement] Get Features",e}();var l=function(){function e(e){this.payload=e}return e.type="[FeatureManagement] Update Features",e}();var f=function(){function e(e,t){this.rest=e,this.store=t}return e.prototype.getFeatures=function(e){var t={method:"GET",url:"/api/abp/features",params:e};return this.rest.request(t)},e.prototype.updateFeatures=function(e){var t={method:"PUT",url:"/api/abp/features",body:{features:e.features},params:{providerKey:e.providerKey,providerName:e.providerName}};return this.rest.request(t)},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:t.RestService},{type:a.Store}]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(t.RestService),n.ɵɵinject(a.Store))},token:e,providedIn:"root"}),e}();var d=function(){function e(e){this.featureManagementService=e}return e.getFeatures=function(e){return e.features||[]},e.prototype.getFeatures=function(e,t){var r=e.patchState,n=t.payload;return this.featureManagementService.getFeatures(n).pipe(i.tap((function(e){var t=e.features;return r({features:t})})))},e.prototype.updateFeatures=function(e,t){var r=t.payload;return this.featureManagementService.updateFeatures(r)},e.ctorParameters=function(){return[{type:f}]},s([a.Action(c),p("design:type",Function),p("design:paramtypes",[Object,c]),p("design:returntype",void 0)],e.prototype,"getFeatures",null),s([a.Action(l),p("design:type",Function),p("design:paramtypes",[Object,l]),p("design:returntype",void 0)],e.prototype,"updateFeatures",null),s([a.Selector(),p("design:type",Function),p("design:paramtypes",[Object]),p("design:returntype",void 0)],e,"getFeatures",null),e=s([a.State({name:"FeatureManagementState",defaults:{features:{}}}),p("design:paramtypes",[f])],e)}();var m=function(){function e(e){this.store=e,this.visibleChange=new n.EventEmitter,this.modalBusy=!1}return Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){this._visible=e,this.visibleChange.emit(e),e&&this.openModal()},enumerable:!0,configurable:!0}),e.prototype.openModal=function(){if(!this.providerKey||!this.providerName)throw new Error("Provider Key and Provider Name are required.");this.getFeatures()},e.prototype.getFeatures=function(){var e=this;this.store.dispatch(new c({providerKey:this.providerKey,providerName:this.providerName})).pipe(i.pluck("FeatureManagementState","features")).subscribe((function(t){e.buildForm(t)}))},e.prototype.buildForm=function(e){for(var t={},r=0;r<e.length;r++)t[r]=new u.FormControl("false"===e[r].value?null:e[r].value);this.form=new u.FormGroup(t)},e.prototype.save=function(){var e=this;if(!this.modalBusy){this.modalBusy=!0;var t=this.store.selectSnapshot(d.getFeatures);t=t.map((function(t,r){return{name:t.name,value:e.form.value[r]&&"false"!==e.form.value[r]?e.form.value[r]:null}})),this.store.dispatch(new l({providerKey:this.providerKey,providerName:this.providerName,features:t})).pipe(i.finalize((function(){return e.modalBusy=!1}))).subscribe((function(){e.visible=!1}))}},e.decorators=[{type:n.Component,args:[{selector:"abp-feature-management",template:'<abp-modal size="md" [(visible)]="visible" [busy]="modalBusy">\r\n  <ng-template #abpHeader>\r\n    <h3>{{ \'AbpTenantManagement::Permission:ManageFeatures\' | abpLocalization }}</h3>\r\n  </ng-template>\r\n\r\n  <ng-template #abpBody>\r\n    <form *ngIf="form" (ngSubmit)="save()" [formGroup]="form" validateOnSubmit>\r\n      <div\r\n        class="row my-3"\r\n        *ngFor="let feature of features$ | async; let i = index"\r\n        [ngSwitch]="feature.valueType.name"\r\n      >\r\n        <div class="col-4">{{ feature.name }}</div>\r\n        <div class="col-8" *ngSwitchCase="\'ToggleStringValueType\'">\r\n          <input type="checkbox" name="feature.name" [formControlName]="i" />\r\n        </div>\r\n        <div class="col-8" *ngSwitchCase="\'FreeTextStringValueType\'">\r\n          <input type="text" name="feature.name" [formControlName]="i" />\r\n        </div>\r\n      </div>\r\n    </form>\r\n  </ng-template>\r\n\r\n  <ng-template #abpFooter>\r\n    <button #abpClose type="button" class="btn btn-secondary">\r\n      {{ \'AbpFeatureManagement::Cancel\' | abpLocalization }}\r\n    </button>\r\n    <abp-button iconClass="fa fa-check" [disabled]="form?.invalid || modalBusy" (click)="save()">\r\n      {{ \'AbpFeatureManagement::Save\' | abpLocalization }}\r\n    </abp-button>\r\n  </ng-template>\r\n</abp-modal>\r\n'}]}],e.ctorParameters=function(){return[{type:a.Store}]},e.propDecorators={providerKey:[{type:n.Input}],providerName:[{type:n.Input}],visible:[{type:n.Input}],visibleChange:[{type:n.Output}]},s([a.Select(d.getFeatures),p("design:type",o.Observable)],e.prototype,"features$",void 0),e}();var g=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{declarations:[m],imports:[t.CoreModule,r.ThemeSharedModule,a.NgxsModule.forFeature([d])],exports:[m]}]}],e}();e.FeatureManagementComponent=m,e.FeatureManagementModule=g,e.ɵa=m,e.ɵb=d,e.ɵc=d,e.ɵd=f,e.ɵe=c,e.ɵf=l,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=abp-ng.feature-management.umd.min.js.map
